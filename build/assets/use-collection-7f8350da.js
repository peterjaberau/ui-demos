import{r as L}from"./index-2c36b58a.js";function W(t,e,r){if(e.length===0)return!0;r=r||Object.keys(t);var n=e.toLowerCase();return r.some(function(a){return String(t[a]).toLowerCase().indexOf(n)>-1})}function B(t,e){var r;if(e===void 0&&(e=""),!t)return null;var n=(r=t.filteringFunction)!==null&&r!==void 0?r:W;return function(a){return n(a,e,t.fields)}}function D(t){return typeof t=="string"?t.includes("T")?new Date(t):new Date(t+"T00:00:00"):new Date(NaN)}function M(t,e){return t instanceof Date&&typeof e=="string"?z(t).getTime()-z(D(e)).getTime():NaN}function $(t,e){return t instanceof Date&&typeof e=="string"?t.getTime()-D(e).getTime():NaN}function z(t){var e=new Date(t.getTime());return e.setHours(0,0,0,0),e}var j=function(t,e){var r=e.tokenValue,n=e.operator,a=n.operator,i=n.match,o=n.tokenType;if(i==="date"||i==="datetime")return q({tokenValue:r,itemValue:t,operator:a,match:i});if(typeof i=="function")return i(t,r);if(i)throw new Error("Unsupported `operator.match` type given.");return H({tokenValue:r,itemValue:t,operator:a,tokenType:o})};function q(t){var e=t.tokenValue,r=t.itemValue,n=t.operator,a=t.match,i=a==="date"?M:$,o=i(r,e);switch(n){case"<":return o<0;case"<=":return o<=0;case">":return o>0;case">=":return o>=0;case"=":return o===0;case"!=":return o!==0;default:return!1}}function H(t){var e=t.tokenValue,r=t.itemValue,n=t.operator,a=t.tokenType;if(a==="enum"){if(!e||!Array.isArray(e))return!1;switch(n){case"=":return e&&e.includes(r);case"!=":return!e||!e.includes(r);default:return!1}}switch(n){case"<":return r<e;case"<=":return r<=e;case">":return r>e;case">=":return r>=e;case"=":return r==e;case"!=":return r!=e;case":":return(r+"").toLowerCase().indexOf((e+"").toLowerCase())>-1;case"!:":return(r+"").toLowerCase().indexOf((e+"").toLowerCase())===-1;case"^":return(r+"").toLowerCase().startsWith((e+"").toLowerCase());case"!^":return!(r+"").toLowerCase().startsWith((e+"").toLowerCase());default:throw new Error("Unsupported operator given.")}}function Z(t,e,r,n){var a=r.startsWith("!");return Object.keys(n)[a?"every":"some"](function(i){var o=n[i].operators,u=o[r];return u?j(e[i],{tokenValue:t,operator:u}):a})}function J(t,e,r){if(t.propertyKey){if(!(t.propertyKey in r)||!(t.operator in r[t.propertyKey].operators))return!1;var n=r[t.propertyKey],a=n.operators[t.operator],i=a!=null&&a.match?e[t.propertyKey]:Q(e[t.propertyKey]);return j(i,{tokenValue:t.value,operator:a??{operator:t.operator}})}return Z(t.value,e,t.operator,r)}function X(t){return function(e,r){var n;function a(i){if("operation"in i){for(var o=i.operation==="and"?!0:!i.tokens.length,u=0,d=i.tokens;u<d.length;u++){var f=d[u];o=i.operation==="and"?o&&a(f):o||a(f)}return o}else return J(i,e,t)}return a({operation:r.operation,tokens:(n=r.tokenGroups)!==null&&n!==void 0?n:r.tokens})}}function Y(t,e){if(e===void 0&&(e={tokens:[],operation:"and"}),!t)return null;var r=t.filteringProperties.reduce(function(a,i){var o,u=i.key,d=i.operators,f=i.defaultOperator,y=(o={},o[f??"="]={operator:f??"="},o);return d==null||d.forEach(function(l){typeof l=="string"?y[l]={operator:l}:y[l.operator]={operator:l.operator,match:l.match,tokenType:l.tokenType}}),a[u]={operators:y},a},{}),n=t.filteringFunction||X(r);return function(a){return n(a,e)}}var Q=function(t){return typeof t=="boolean"?t+"":t||t===0?t:""};function G(t){return t?function(e,r){var n,a,i=(n=e[t])!==null&&n!==void 0?n:"",o=(a=r[t])!==null&&a!==void 0?a:"";return typeof i=="string"&&typeof o=="string"?i.localeCompare(o):i<o?-1:i==o?0:1}:null}function _(t,e){var r;if(!t||!e)return null;var n=e.isDescending?-1:1,a=(r=e.sortingColumn.sortingComparator)!==null&&r!==void 0?r:G(e.sortingColumn.sortingField);return a?function(i,o){return a(i,o)*n}:null}var ee=10;function te(t,e,r){var n;if(!t)return null;var a=(n=t.pageSize)!==null&&n!==void 0?n:ee,i=Math.ceil(r.length/a),o=e??1;return(o<1||o>i||Number.isNaN(o))&&(o=1),{pageSize:a,pagesCount:i,pageIndex:o}}var re=function(){function t(e,r){var n=this,a;if(this.size=0,this.hasNesting=!1,this.roots=new Array,this.idToChildren=new Map,this.filter=function(l){return n.hasNesting?n.filterTree(l):(n.items=n.items.filter(l),n.size=n.items.length),n},this.sort=function(l){return n.hasNesting?n.sortTree(l):n.items=n.items.slice().sort(l),n},this.getChildren=function(l){var s;return(s=n.treeProps&&n.idToChildren.get(n.treeProps.getId(l)))!==null&&s!==void 0?s:[]},this.getItems=function(){return n.hasNesting?n.roots:n.items},this.getSize=function(){return n.size},this.filterTree=function(l){var s=function(g){var h=n.getChildren(g),I=h.filter(s);return n.size-=h.length-I.length,n.setChildren(g,I),l(g)||I.length>0},c=n.roots;n.roots=n.roots.filter(s),n.size-=c.length-n.roots.length},this.sortTree=function(l){var s=function(c){c.sort(l);for(var g=0,h=c;g<h.length;g++){var I=h[g];s(n.getChildren(I))}};s(n.roots)},this.size=e.length,this.items=e,this.treeProps=r,!!r){for(var i=0,o=e;i<o.length;i++){var u=o[i],d=r.getParentId(u);if(d===null)this.roots.push(u);else{var f=(a=this.idToChildren.get(d))!==null&&a!==void 0?a:[];f.push(u),this.idToChildren.set(d,f),this.hasNesting=!0}}var y=function(l,s){for(var c,g=0,h=(c=n.idToChildren.get(r.getId(l)))!==null&&c!==void 0?c:[];g<h.length;g++){var I=h[g];y(I)}};this.roots.forEach(function(l){return y(l)})}}return t.prototype.setChildren=function(e,r){this.treeProps&&this.idToChildren.set(this.treeProps.getId(e),r)},t}();function ne(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.some(Boolean)?function(r){for(var n=0,a=t;n<a.length;n++){var i=a[n];if(i&&!i(r))return!1}return!0}:null}function ae(t,e,r){var n=e.filteringText,a=e.sortingState,i=e.currentPageIndex,o=e.propertyFilteringQuery,u=r.filtering,d=r.sorting,f=r.pagination,y=r.propertyFiltering,l=r.expandableRows,s=new re(t,l),c=ne(Y(y,o),B(u,n));c&&s.filter(c);var g=_(d,a);g&&s.sort(g);var h=s.getItems(),I=c?s.getSize():void 0,p=te(f,i,h);return p?{items:h.slice((p.pageIndex-1)*p.pageSize,p.pageIndex*p.pageSize),allPageItems:h,filteredItemsCount:I,pagesCount:p==null?void 0:p.pagesCount,actualPageIndex:p==null?void 0:p.pageIndex,itemsTree:s}:{items:h,allPageItems:h,filteredItemsCount:I,pagesCount:void 0,actualPageIndex:void 0,itemsTree:s}}var k=function(t,e){return t?typeof t=="function"?t(e):e[t]:e},ie=function(t,e,r){var n=new Set;return e.forEach(function(a){return n.add(k(r,a))}),t.filter(function(a){return n.has(k(r,a))})},O=function(t,e,r){if(t.length!==e.length)return!1;var n=new Set;return t.forEach(function(a){return n.add(k(r,a))}),e.every(function(a){return n.has(k(r,a))})},T=globalThis&&globalThis.__assign||function(){return T=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t},T.apply(this,arguments)},A=globalThis&&globalThis.__spreadArray||function(t,e,r){if(r||arguments.length===2)for(var n=0,a=e.length,i;n<a;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return t.concat(i||Array.prototype.slice.call(e))};function oe(t,e){var r=T({},t);switch(e.type){case"selection":r.selectedItems=e.selectedItems;break;case"expansion":r.expandedItems=e.expandedItems;break;case"filtering":r.currentPageIndex=1,r.filteringText=e.filteringText;break;case"sorting":r.currentPageIndex=1,r.sortingState=e.sortingState;break;case"pagination":r.currentPageIndex=e.pageIndex;break;case"property-filtering":r.currentPageIndex=1,r.propertyFilteringQuery=e.query;break}return r}function le(t){var e=t.dispatch,r=t.collectionRef;return{setFiltering:function(n){e({type:"filtering",filteringText:n}),r.current&&r.current.scrollToTop()},setSorting:function(n){e({type:"sorting",sortingState:n}),r.current&&r.current.scrollToTop()},setCurrentPage:function(n){e({type:"pagination",pageIndex:n}),r.current&&r.current.scrollToTop()},setSelectedItems:function(n){e({type:"selection",selectedItems:n})},setPropertyFiltering:function(n){e({type:"property-filtering",query:n}),r.current&&r.current.scrollToTop()},setExpandedItems:function(n){e({type:"expansion",expandedItems:n})}}}function ue(t,e,r,n,a){var i,o,u,d,f,y=e.filteringText,l=e.sortingState,s=e.selectedItems,c=e.expandedItems,g=e.currentPageIndex,h=e.propertyFilteringQuery,I=a.pagesCount,p=a.actualPageIndex,P=a.allItems,R=a.allPageItems,S=a.itemsTree,w=t.filtering?P.length?t.filtering.noMatch:t.filtering.empty:null;w=t.propertyFiltering?P.length?t.propertyFiltering.noMatch:t.propertyFiltering.empty:w;var b=t.propertyFiltering?t.propertyFiltering.filteringProperties.reduce(function(v,m){return Object.keys(P.reduce(function(x,C){return x[""+Q(C[m.key])]=!0,x},{})).forEach(function(x){x!==""&&v.push({propertyKey:m.key,value:x})}),v},[]):[];return{collectionProps:T(T(T(T(T({empty:w},t.sorting?{onSortingChange:function(v){var m=v.detail;r.setSorting(m)},sortingColumn:l==null?void 0:l.sortingColumn,sortingDescending:l==null?void 0:l.isDescending}:{}),t.expandableRows?{expandableRows:{getItemChildren:function(v){return S.getChildren(v)},isItemExpandable:function(v){return S.getChildren(v).length>0},expandedItems:c,onExpandableItemToggle:function(v){var m=v.detail,x=m.item,C=m.expanded,F=t.expandableRows.getId;if(C){for(var E=0,N=c;E<N.length;E++){var K=N[E];if(F(K)===F(x))return}r.setExpandedItems(A(A([],c,!0),[x],!1))}else r.setExpandedItems(c.filter(function(U){return F(U)!==F(x)}))}},trackBy:t.expandableRows.getId}:{}),t.selection?{onSelectionChange:function(v){var m=v.detail.selectedItems;r.setSelectedItems(m)},selectedItems:s,trackBy:(i=t.selection.trackBy)!==null&&i!==void 0?i:(o=t.expandableRows)===null||o===void 0?void 0:o.getId}:{}),{ref:n,firstIndex:1,totalItemsCount:R.length}),!((u=t.pagination)===null||u===void 0)&&u.pageSize?{firstIndex:((p??g)-1)*t.pagination.pageSize+1}:{}),filterProps:{filteringText:y,onChange:function(v){var m=v.detail.filteringText;r.setFiltering(m)}},propertyFilterProps:{query:h,onChange:function(v){var m=v.detail;r.setPropertyFiltering(m)},filteringProperties:((d=t.propertyFiltering)===null||d===void 0?void 0:d.filteringProperties)||[],filteringOptions:b,freeTextFiltering:(f=t.propertyFiltering)===null||f===void 0?void 0:f.freeTextFiltering},paginationProps:{currentPageIndex:p??g,pagesCount:I,onChange:function(v){var m=v.detail.currentPageIndex;r.setCurrentPage(m)}}}}function se(t,e){var r,n,a,i,o,u,d,f,y,l,s,c=L.useReducer(oe,{selectedItems:(n=(r=t.selection)===null||r===void 0?void 0:r.defaultSelectedItems)!==null&&n!==void 0?n:[],expandedItems:(i=(a=t.expandableRows)===null||a===void 0?void 0:a.defaultExpandedItems)!==null&&i!==void 0?i:[],sortingState:(o=t.sorting)===null||o===void 0?void 0:o.defaultState,currentPageIndex:(d=(u=t.pagination)===null||u===void 0?void 0:u.defaultPage)!==null&&d!==void 0?d:1,filteringText:(y=(f=t.filtering)===null||f===void 0?void 0:f.defaultFilteringText)!==null&&y!==void 0?y:"",propertyFilteringQuery:(s=(l=t.propertyFiltering)===null||l===void 0?void 0:l.defaultQuery)!==null&&s!==void 0?s:{tokens:[],operation:"and"}}),g=c[0],h=c[1];return[g,le({dispatch:h,collectionRef:e})]}var V=globalThis&&globalThis.__assign||function(){return V=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t},V.apply(this,arguments)};function ce(t,e){var r=L.useRef(null),n=se(e,r),a=n[0],i=n[1],o=ae(t,a,e),u=o.items,d=o.allPageItems,f=o.pagesCount,y=o.filteredItemsCount,l=o.actualPageIndex,s=o.itemsTree,c=new Set;if(e.expandableRows)for(var g=0,h=a.expandedItems;g<h.length;g++){var I=h[g];c.add(e.expandableRows.getId(I))}var p=u;if(e.expandableRows){var P=new Array,R=e.expandableRows.getId,S=function(v){for(var m=0,x=v;m<x.length;m++){var C=x[m];P.push(C),c.has(R(C))&&S(s.getChildren(C))}};S(u),p=P}if(e.selection&&!e.selection.keepSelection){var w=ie(p,a.selectedItems,e.selection.trackBy);O(w,a.selectedItems,e.selection.trackBy)||i.setSelectedItems(w)}if(e.expandableRows){var b=p.filter(function(v){return c.has(e.expandableRows.getId(v))});O(b,a.expandedItems,e.expandableRows.getId)||i.setExpandedItems(b)}return V({items:u,allPageItems:d,filteredItemsCount:y,actions:i},ue(e,a,i,r,{actualPageIndex:l,pagesCount:f,allItems:t,allPageItems:d,itemsTree:s}))}export{ce as u};
