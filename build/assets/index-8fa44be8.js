import{_ as re,b as ie,e as le,c as ae,d as se}from"./index-eb73e870.js";import{R as m,r as c}from"./index-2c36b58a.js";import"./ResizeObserver-6fd345a6.js";import{u as O}from"./use-resize-observer-2cd5ced9.js";import{I as ue}from"./internal-70a60edf.js";import{I as de}from"./internal-fb301464.js";import{F as ce}from"./internal-4ec290ce.js";import{u as ve}from"./context-d1fbdd85.js";import{b as me}from"./index-491afaa4.js";import{I as ge}from"./internal-4584f44c.js";import{S as fe}from"./internal-616d830c.js";import{I as ye}from"./internal-6057655b.js";import{K as q}from"./keycode-5e563e63.js";import{m as pe,P as ke}from"./promises-8a0da413.js";const D={root:"awsui_root_brdst_19vdi_145",loading:"awsui_loading_brdst_19vdi_149","undo-button":"awsui_undo-button_brdst_19vdi_153"},Y=m.forwardRef(({row:t,value:s,readOnly:a,defaultOptions:n,placeholder:x,errorText:E,loadingText:d,suggestionText:f,tooManySuggestionText:i,limit:e,filteringKey:B,enteredTextLabel:y,clearAriaLabel:_,onChange:N,onBlur:I,onRequest:K,initialOptionsRef:b},V)=>{const[l,p]=c.useState(n),[P,k]=c.useState(),S=c.useRef({cancel:()=>{},isCancelled:()=>!1}),h=c.useRef({key:void 0,value:void 0}),U=(g,F)=>h.current.key===g&&h.current.value===F,L=g=>{if(!K||U(B,g)||S.current.isCancelled())return;S.current.cancel(),h.current.key!==B?p([]):g===""&&(b!=null&&b.current)&&b.current.length>0&&p(b.current),k("loading"),h.current={key:B,value:g};const{promise:F,cancel:T,isCancelled:R}=pe(K(g));F.then(M=>{const j=M.map(H=>({value:H}));k(void 0),p(j),b&&(b.current=j)}).catch(M=>{M instanceof ke||k("error")}),S.current={cancel:T,isCancelled:R}};return m.createElement(ye,{ref:V,value:s,readOnly:a,statusType:P,options:l.length<e?l:[],empty:l.length<e?f:i,placeholder:x,errorText:E,loadingText:d,enteredTextLabel:y,clearAriaLabel:_,onChange:({detail:g})=>N(g.value,t),onBlur:()=>I==null?void 0:I(t),onFocus:()=>{L("")},onLoadItems:({detail:g})=>{L(g.filteringText)}})}),Ee=m.forwardRef(({children:t,onClick:s},a)=>m.createElement("a",{ref:a,role:"button",tabIndex:0,className:D["undo-button"],onClick:s,onKeyDown:n=>{(n.keyCode===q.space||n.keyCode===q.enter)&&n.preventDefault(),n.keyCode===q.enter&&s()},onKeyUp:n=>{n.keyCode===q.space&&s()}},t));function be(t,s){for(let a=0;a<t.length;a++)if(s(t[a]))return a;return-1}function W(t,s,a){for(let n=0;n<Math.max(t.length,s.length);n++){if(n===s.length)return t.slice(0,n);if(n===t.length)return[...t.slice(0,n),...s.slice(n)];if(!a(t[n],s[n]))return[...t.slice(0,n),s[n],...W(t.slice(n+1),s.slice(n+1),a)]}return t}function xe(t,s){const a=c.useRef(t),n=W(a.current,t,s);return c.useEffect(()=>{a.current=n},[n]),n}const ee=/^([\p{L}\p{Z}\p{N}_.:/=+\-@]*)$/u,_e="aws:",he=128,Le=256;function Z(t,s,a,n,x=ee){const E={};return t.forEach(d=>{var f;d.key&&!d.markedForRemoval&&(E[d.key]=((f=E[d.key])!==null&&f!==void 0?f:0)+1)}),t.map((d,f)=>{let i,e;if(s[f]&&Ie(d.key)?i=a("i18nStrings.emptyKeyError",n==null?void 0:n.emptyKeyError):Re(d.key)?i=a("i18nStrings.awsPrefixError",n==null?void 0:n.awsPrefixError):J(d.key,x)?i=a("i18nStrings.invalidKeyError",n==null?void 0:n.invalidKeyError):Se(d.key)?i=a("i18nStrings.maxKeyCharLengthError",n==null?void 0:n.maxKeyCharLengthError):Ce(d.key,E)&&(i=a("i18nStrings.duplicateKeyError",n==null?void 0:n.duplicateKeyError)),d.markedForRemoval||(J(d.value,x)?e=a("i18nStrings.invalidValueError",n==null?void 0:n.invalidValueError):Ae(d.value)&&(e=a("i18nStrings.maxValueCharLengthError",n==null?void 0:n.maxValueCharLengthError))),i||e)return{key:i,value:e}})}const Re=t=>t.toLowerCase().indexOf(_e)===0,Ie=t=>!t||t.trim().length===0,Se=t=>t&&t.length>he,Ce=(t,s)=>{var a;return((a=s==null?void 0:s[t])!==null&&a!==void 0?a:0)>1},Ae=t=>t&&t.length>Le,J=(t,s=ee)=>!t||!s?!1:!s.test(t),Te=({tag:t})=>!t.markedForRemoval,oe=m.forwardRef((t,s)=>{var a,n,x,E,d,f,{tags:i=[],i18nStrings:e,loading:B=!1,tagLimit:y=50,allowedCharacterPattern:_,keysRequest:N,valuesRequest:I,onChange:K}=t,b=re(t,["tags","i18nStrings","loading","tagLimit","allowedCharacterPattern","keysRequest","valuesRequest","onChange"]);const V=ie("TagEditor",{props:{tagLimit:y,allowedCharacterPattern:_}}),l=ve("tag-editor"),p=y-i.filter(o=>!o.markedForRemoval).length,P=c.useRef(null),k=c.useRef([]),S=c.useRef([]),h=c.useRef([]),U=c.useRef([]),L=c.useRef([]),g=c.useRef();c.useLayoutEffect(()=>{var o;(o=g.current)===null||o===void 0||o.apply(void 0),g.current=void 0});const F=Z(i,L.current,l,e,_?new RegExp(_):void 0),T=xe(i.map((o,r)=>({tag:o,error:F[r]})),(o,r)=>{var v,u,C,A;return o.tag===r.tag&&((v=o.error)===null||v===void 0?void 0:v.key)===((u=r.error)===null||u===void 0?void 0:u.key)&&((C=o.error)===null||C===void 0?void 0:C.value)===((A=r.error)===null||A===void 0?void 0:A.value)});c.useImperativeHandle(s,()=>({focus(){var o,r;const v=be(T,({error:u})=>(u==null?void 0:u.key)||(u==null?void 0:u.value));v!==-1&&((r=(!((o=T[v].error)===null||o===void 0)&&o.key?k:S).current[v])===null||r===void 0||r.focus())}}),[T]);const R=c.useCallback(o=>{me(K,{tags:o,valid:!Z(o,L.current,l,e,_?new RegExp(_):void 0).some(r=>r)})},[K,l,e,_]),M=()=>{R([...i,{key:"",value:"",existing:!1}]),g.current=()=>{var o;(o=k.current[i.length])===null||o===void 0||o.focus()}},j=O(({detail:o})=>{var r,v,u,C,A;const Q=i[o.itemIndex].existing;R([...i.slice(0,o.itemIndex),...Q?[Object.assign(Object.assign({},i[o.itemIndex]),{markedForRemoval:!0})]:[],...i.slice(o.itemIndex+1)]),Q?g.current=()=>{var w;(w=h.current[o.itemIndex])===null||w===void 0||w.focus()}:(L.current.splice(o.itemIndex,1),k.current[o.itemIndex+1]?(r=k.current[o.itemIndex])===null||r===void 0||r.focus():o.itemIndex>0?i[o.itemIndex-1].existing?i[o.itemIndex-1].markedForRemoval?(v=h.current[o.itemIndex-1])===null||v===void 0||v.focus():(u=S.current[o.itemIndex-1])===null||u===void 0||u.focus():(C=k.current[o.itemIndex-1])===null||C===void 0||C.focus():(A=P.current)===null||A===void 0||A.focusAddButton())}),H=O((o,r)=>{L.current[r]=!0,R([...i.slice(0,r),Object.assign(Object.assign({},i[r]),{key:o}),...i.slice(r+1)])}),G=O(o=>{L.current[o]=!0,R([...i])}),X=O((o,r)=>{R([...i.slice(0,r),Object.assign(Object.assign({},i[r]),{value:o}),...i.slice(r+1)])}),$=O(o=>{R([...i.slice(0,o),Object.assign(Object.assign({},i[o]),{markedForRemoval:!1}),...i.slice(o+1)]),g.current=()=>{var r;(r=P.current)===null||r===void 0||r.focusRemoveButton(o)}}),ne=c.useMemo(()=>[{label:l("i18nStrings.keyHeader",e==null?void 0:e.keyHeader),control:({tag:o},r)=>m.createElement(Y,{row:r,value:o.key,readOnly:o.existing,limit:200,defaultOptions:[],placeholder:l("i18nStrings.keyPlaceholder",e==null?void 0:e.keyPlaceholder),errorText:l("i18nStrings.keysSuggestionError",e==null?void 0:e.keysSuggestionError),loadingText:l("i18nStrings.keysSuggestionLoading",e==null?void 0:e.keysSuggestionLoading),suggestionText:l("i18nStrings.keySuggestion",e==null?void 0:e.keySuggestion),tooManySuggestionText:l("i18nStrings.tooManyKeysSuggestion",e==null?void 0:e.tooManyKeysSuggestion),enteredTextLabel:e==null?void 0:e.enteredKeyLabel,clearAriaLabel:e==null?void 0:e.clearAriaLabel,onRequest:N,onChange:H,onBlur:G,initialOptionsRef:U,ref:v=>{k.current[r]=v}}),errorText:({error:o})=>o==null?void 0:o.key},{label:m.createElement("span",null,l("i18nStrings.valueHeader",e==null?void 0:e.valueHeader)," -"," ",m.createElement("i",null,l("i18nStrings.optional",e==null?void 0:e.optional))),control:({tag:o},r)=>{var v;return o.markedForRemoval?m.createElement("div",{role:"alert"},m.createElement(de,{margin:{top:"xxs"}},l("i18nStrings.undoPrompt",e==null?void 0:e.undoPrompt)," ",m.createElement(Ee,{onClick:()=>$(r),ref:u=>{h.current[r]=u}},l("i18nStrings.undoButton",e==null?void 0:e.undoButton)))):m.createElement(Y,{row:r,value:o.value,readOnly:!1,limit:200,defaultOptions:(v=o.valueSuggestionOptions)!==null&&v!==void 0?v:[],placeholder:l("i18nStrings.valuePlaceholder",e==null?void 0:e.valuePlaceholder),errorText:l("i18nStrings.valuesSuggestionError",e==null?void 0:e.valuesSuggestionError),loadingText:l("i18nStrings.valuesSuggestionLoading",e==null?void 0:e.valuesSuggestionLoading),suggestionText:l("i18nStrings.valueSuggestion",e==null?void 0:e.valueSuggestion),tooManySuggestionText:l("i18nStrings.tooManyValuesSuggestion",e==null?void 0:e.tooManyValuesSuggestion),enteredTextLabel:e==null?void 0:e.enteredValueLabel,clearAriaLabel:e==null?void 0:e.clearAriaLabel,filteringKey:o.key,onRequest:I&&(u=>I(o.key,u)),onChange:X,ref:u=>{S.current[r]=u}})},errorText:({error:o})=>o==null?void 0:o.value}],[l,e,N,H,G,I,X,$]),te=c.useMemo(()=>({errorIconAriaLabel:e==null?void 0:e.errorIconAriaLabel,itemRemovedAriaLive:e==null?void 0:e.itemRemovedAriaLive,removeButtonAriaLabel:l("i18nStrings.removeButtonAriaLabel",(e==null?void 0:e.removeButtonAriaLabel)&&(({tag:o})=>e.removeButtonAriaLabel(o)),o=>({tag:r})=>o({tag__key:r.key}))}),[e,l]);if(B)return m.createElement("div",{className:D.root,ref:V.__internalRootRef},m.createElement(fe,{className:D.loading,type:"loading"},m.createElement(ge,{tagName:"span"},l("i18nStrings.loading",e==null?void 0:e.loading))));const z=le(b);return m.createElement(ue,Object.assign({},z,V,{ref:P,className:ae(D.root,z.className),items:T,isItemRemovable:Te,onAddButtonClick:M,onRemoveButtonClick:j,addButtonText:(a=l("i18nStrings.addButton",e==null?void 0:e.addButton))!==null&&a!==void 0?a:"",removeButtonText:e==null?void 0:e.removeButton,disableAddButton:p<=0,empty:l("i18nStrings.emptyTags",e==null?void 0:e.emptyTags),additionalInfo:p<0?m.createElement(ce,{errorIconAriaLabel:e==null?void 0:e.errorIconAriaLabel},(x=l("i18nStrings.tagLimitExceeded",(n=e==null?void 0:e.tagLimitExceeded)===null||n===void 0?void 0:n.call(e,y),o=>o({tagLimit:y})))!==null&&x!==void 0?x:""):p===0?(d=l("i18nStrings.tagLimitReached",(E=e==null?void 0:e.tagLimitReached)===null||E===void 0?void 0:E.call(e,y),o=>o({tagLimit:y})))!==null&&d!==void 0?d:"":l("i18nStrings.tagLimit",(f=e==null?void 0:e.tagLimit)===null||f===void 0?void 0:f.call(e,p,y),o=>o({tagLimitAvailable:`${p===y}`,availableTags:p,tagLimit:y})),definition:ne,i18nStrings:te}))});se(oe,"TagEditor");const Xe=oe;export{Xe as T};
