import{_ as L,P as U,f as M}from"./index-eb73e870.js";import{R as N,r}from"./index-2c36b58a.js";import{u as B}from"./index-842d48b3.js";import{u as j}from"./index-5c04613c.js";import{n as q}from"./node-belongs-c9e88748.js";import{u as x,F as G,a as R,b as W,c as k}from"./use-funnel-f65631cb.js";import{F as y}from"./index-b7e4292a.js";import{g as O,a as _,D as Y,b as w,c as P,d as z,e as H}from"./selectors-2871d9bb.js";const K="1.4",ae=n=>{const{isInFunnel:i}=x();return i&&n.funnelType==="single-page"?N.createElement(N.Fragment,null,n.children):N.createElement(Z,Object.assign({},n))},$="awsui-creation-edit-flow-done",J=()=>{var n;try{(n=window.top)===null||n===void 0||n.document.dispatchEvent(new Event($))}catch{}},Q=({funnelInteractionId:n,funnelIdentifier:i})=>{},D=n=>{y.funnelComplete({funnelInteractionId:n.taskInteractionId,funnelIdentifier:n.taskIdentifier}),J()};function X(n,i){for(const u of n)if(document.querySelector(u))return u;return i}const Z=n=>{var{mounted:i=!0,children:u,stepConfiguration:t}=n,e=L(n,["mounted","children","stepConfiguration"]);const[S,l]=r.useState(""),[o,a]=r.useState(0),c=r.useRef("default"),f=r.useRef(O()),m=r.useRef(0),E=r.useRef(0),I=r.useRef(0),v=r.useRef(void 0),g=r.useRef(0);r.useEffect(()=>{if(!i)return;let d;const T=setTimeout(()=>{var s;if(f.current=X(e.funnelNameSelectors||[],O()),e.funnelType==="single-page"&&I.current>0)return;c.current="default";const F=(s=_(f.current))!==null&&s!==void 0?s:"",V=[{number:1,isOptional:!1,name:F,stepIdentifier:e.funnelIdentifier}];d=y.funnelStart({funnelName:F,funnelIdentifier:e.funnelIdentifier,flowType:e.funnelFlowType,funnelNameSelector:f.current,optionalStepNumbers:e.optionalStepNumbers,funnelType:e.funnelType,totalFunnelSteps:e.totalFunnelSteps,componentVersion:U,componentTheme:"vr",funnelVersion:K,stepConfiguration:t??V,resourceType:e.funnelResourceType||_(`[${Y}]`)}),l(d)},1);return()=>{if(clearTimeout(T),!(e.funnelType==="single-page"&&I.current>0)){if(c.current==="validating"){const s={taskIdentifier:e.funnelIdentifier,taskType:e.funnelType,timeToRespondAfterFormSubmit:performance.now()-g.current,taskInteractionId:d,taskFlowType:e.funnelFlowType};D(s),c.current="complete"}c.current==="complete"?y.funnelSuccessful({funnelInteractionId:d,funnelIdentifier:e.funnelIdentifier}):(c.current="cancelled",Q({funnelInteractionId:d,funnelIdentifier:e.funnelIdentifier}))}}},[i]);const b=()=>{c.current="validating",g.current=performance.now();const d=50,T=100,s=()=>{if(c.current!=="complete"){if(E.current>0){setTimeout(s,T);return}if(m.current===0){const F={taskIdentifier:e.funnelIdentifier,taskType:e.funnelType,timeToRespondAfterFormSubmit:performance.now()-g.current,taskInteractionId:S,taskFlowType:e.funnelFlowType};D(F),c.current="complete"}else c.current="default"}};setTimeout(s,d)},p=()=>a(d=>d+1),C=()=>{},A={funnelInteractionId:S,funnelIdentifier:e.funnelIdentifier,funnelFlowType:e.funnelFlowType,funnelErrorContext:e.funnelErrorContext,setFunnelInteractionId:l,funnelType:e.funnelType,optionalStepNumbers:e.optionalStepNumbers,totalFunnelSteps:e.totalFunnelSteps,funnelNameSelector:f.current,funnelSubmit:b,funnelCancel:C,submissionAttempt:o,funnelNextOrSubmitAttempt:p,funnelState:c,errorCount:m,loadingButtonCount:E,latestFocusCleanupFunction:v,isInFunnel:!0,wizardCount:I};return N.createElement(G.Provider,{value:A},u)},fe=n=>N.createElement(ne,Object.assign({},n,{key:n.stepNumber}));function h(){return Array.from(document.querySelectorAll(w())).map((u,t)=>{var e,S,l,o,a;const c=(S=(e=u==null?void 0:u.__awsuiMetadata__)===null||e===void 0?void 0:e.analytics)===null||S===void 0?void 0:S.instanceIdentifier;return{name:(a=(o=(l=u.querySelector(P()))===null||l===void 0?void 0:l.innerText)===null||o===void 0?void 0:o.trim())!==null&&a!==void 0?a:"",number:t+1,subStepIdentifier:c}})}function ee(n,i){const u=r.useRef(new Map),t=50,e=r.useRef(!1);return r.useEffect(()=>{const l=setTimeout(()=>e.current=!0,t);return()=>{clearTimeout(l),e.current=!1}},[]),r.useEffect(()=>{const l=setTimeout(()=>u.current.set(n,h()),t);return()=>{clearTimeout(l)}},[n]),{onStepChange:B(()=>{e.current&&(u.current.set(n,h()),i(u.current.get(n)))},t),subStepConfiguration:u}}const ne=n=>{var{mounted:i=!0,children:u,stepNumber:t,stepIdentifier:e,stepErrorContext:S}=n,l=L(n,["mounted","children","stepNumber","stepIdentifier","stepErrorContext"]);const{funnelInteractionId:o,funnelIdentifier:a,funnelNameSelector:c,funnelState:f,funnelType:m}=x(),E=R(),I=E.isInStep,v=E.funnelInteractionId,g={[H]:t},b=r.useRef(0),p=l.stepNameSelector||c,{onStepChange:C,subStepConfiguration:A}=ee(t,s=>{o&&y.funnelStepChange({stepIdentifier:e,funnelIdentifier:a,funnelInteractionId:o,stepNumber:t,stepNameSelector:p,subStepAllSelector:w(),totalSubSteps:b.current,subStepConfiguration:s})});r.useEffect(()=>{if(!o||i)return;const s=_(p),F=setTimeout(()=>{f.current!=="cancelled"&&y.funnelStepComplete({funnelIdentifier:a,funnelInteractionId:o,stepIdentifier:e,stepNumber:t,stepName:s,stepNameSelector:p,subStepAllSelector:w(),totalSubSteps:b.current})},0);return()=>{clearTimeout(F)}},[e,a,o,t,p,f,I,m,v,i]),r.useEffect(()=>{if(!o||I&&v)return;const s=_(p);return f.current==="default"&&y.funnelStepStart({stepIdentifier:e,funnelIdentifier:a,funnelInteractionId:o,stepNumber:t,stepName:s,stepNameSelector:p,subStepAllSelector:w(),totalSubSteps:b.current,subStepConfiguration:h()}),()=>{f.current!=="cancelled"&&y.funnelStepComplete({funnelIdentifier:a,funnelInteractionId:o,stepIdentifier:e,stepNumber:t,stepName:s,stepNameSelector:p,subStepAllSelector:w(),totalSubSteps:b.current})}},[e,a,o,t,p,f,I,m,v]);const T=I&&v?E:{stepIdentifier:e,stepNumber:t,stepNameSelector:p,funnelStepProps:g,subStepCount:b,isInStep:!0,funnelInteractionId:o,onStepChange:C,subStepConfiguration:A,stepErrorContext:S};return N.createElement(W.Provider,{value:T},typeof u=="function"?u(T):u)},pe=({children:n,subStepIdentifier:i,subStepErrorContext:u})=>{const t=j("substep"),e=z(t),S=P(t),l=r.useRef(null),{subStepCount:o,onStepChange:a}=R(),c=r.useRef(!1),f=r.useRef(!1),m=r.useRef(void 0),{funnelState:E,funnelInteractionId:I}=x(),{stepNumber:v,stepNameSelector:g}=R(),b={subStepIdentifier:i,subStepErrorContext:u,subStepSelector:e,subStepNameSelector:S,subStepId:t,subStepRef:l,mousePressed:c,isFocusedSubStep:f,focusCleanupFunction:m,isNestedSubStep:!1},p=Object.assign(Object.assign({},r.useContext(k)),{isNestedSubStep:!0}),C=!!p.subStepId;r.useEffect(()=>{if(!C)return o.current++,a(),()=>{o.current--,a()}},[C,o,a]);const A=C?p:b;return r.useEffect(()=>{if(C||!l.current)return;const d=()=>c.current=!0,T=()=>M(void 0,void 0,void 0,function*(){var s;c.current=!1,f.current&&(yield new Promise(F=>setTimeout(F,1)),(!l.current||!document.activeElement||!q(l.current,document.activeElement))&&(f.current=!1,(s=m.current)===null||s===void 0||s.call(m)))});return window.addEventListener("mousedown",d),window.addEventListener("mouseup",T),()=>{window.removeEventListener("mousedown",d),window.removeEventListener("mouseup",T)}},[I,E,g,v,S,e,m,C,l]),N.createElement(k.Provider,{value:A},typeof n=="function"?n(A):n)};export{pe as A,ae as a,fe as b};
