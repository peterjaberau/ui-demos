import{c as Le,_ as He,e as Mt}from"./index-eb73e870.js";import{r as p,R as m}from"./index-2c36b58a.js";import"./ResizeObserver-6fd345a6.js";import{b as Pt,C as Tt,d as wt,e as Lt,u as Dt,a as Nt,k as Rt,f as Ft,g as It,h as At,i as Ot,j as Bt}from"./index-c9377798.js";import{b as Ue}from"./index-491afaa4.js";import{u as Ze}from"./index-cef6af85.js";import{u as rt}from"./index-33af1cce.js";import{a as Qe,n as ct}from"./node-belongs-c9e88748.js";import{b as Ht}from"./index-47bb06f7.js";import{s as Xt,l as Vt,u as zt,C as Gt,A as Je,L as $t,I as Wt,E as et,V as Yt,H as jt,B as Kt,a as qt,c as Ut,N as Zt,b as Qt,g as Jt,d as en}from"./vertical-marker-d6abf42b.js";import{u as tn}from"./index-84af6bb2.js";import{d as nn}from"./internal-1d1af924.js";import{u as tt}from"./index-5c04613c.js";import{K as ne}from"./keycode-5e563e63.js";import{c as nt}from"./circle-index-ff7c6070.js";const sn=p.memo(on);function on({ticks:o,scale:t,height:a}){return m.createElement("g",{"aria-hidden":"true"},o.map(n=>{var i;const d=(i=t.d3Scale(n))!==null&&i!==void 0?i:NaN;return isFinite(d)&&m.createElement("line",{key:n,className:Xt.grid,x1:d,y1:0,x2:d,y2:a})}))}const ie={series:"awsui_series_1yz9c_q05ed_189","series--bar":"awsui_series--bar_1yz9c_q05ed_190",series__rect:"awsui_series__rect_1yz9c_q05ed_190",exiting:"awsui_exiting_1yz9c_q05ed_207","awsui-motion-fade-out-0":"awsui_awsui-motion-fade-out-0_1yz9c_q05ed_1",root:"awsui_root_1yz9c_q05ed_229","series--highlighted":"awsui_series--highlighted_1yz9c_q05ed_242","series__bar--highlighted":"awsui_series__bar--highlighted_1yz9c_q05ed_243","series--dimmed":"awsui_series--dimmed_1yz9c_q05ed_247","series--threshold":"awsui_series--threshold_1yz9c_q05ed_251","bar-group":"awsui_bar-group_1yz9c_q05ed_256"},Re=2;function an({ariaLabel:o,isRefresh:t,isPopoverPinned:a,barGroups:n,highlightedGroupIndex:i,highlightedGroupRef:d}){return m.createElement("g",{role:"group","aria-hidden":"true"},n.map((l,s)=>m.createElement("rect",{key:s,x:Math.max(0,l.position.x-Re),y:Math.max(0,l.position.y-Re),width:l.position.width+2*Re,height:l.position.height+2*Re,ref:s===i?d:void 0,rx:t?4:2,role:"button","aria-label":o,"aria-haspopup":!0,"aria-expanded":a,fill:"none",className:ie["bar-group"]})))}const ln=m.forwardRef(rn);function rn({containerRef:o,trackRef:t,isOpen:a,isPinned:n,highlightDetails:i,footer:d,onDismiss:l,size:s="medium",dismissAriaLabel:r,onMouseEnter:e,onMouseLeave:c,onBlur:u,setPopoverText:f},E){const[v,R]=p.useState({});return m.createElement(nn,{in:a},(h,T)=>m.createElement("div",{ref:T,className:Le(h==="exiting"&&ie.exiting)},(a||h!=="exited")&&i&&m.createElement(Pt,{ref:E,title:i.position,trackRef:t,trackKey:i.position,dismissButton:n,dismissAriaLabel:r,onDismiss:l,container:o.current,size:s,onMouseEnter:e,onMouseLeave:c,onBlur:u},m.createElement(Tt,{key:i.position,details:i.details,setPopoverText:f,expandedSeries:v[i.position],setExpandedState:(b,w)=>R(F=>{const S=new Set(F[i.position]);return w?S.add(b):S.delete(b),Object.assign(Object.assign({},F),{[i.position]:S})})}),d&&m.createElement(wt,null,d))))}function cn({x:o,y:t,width:a,height:n},i,d){const l=[{x:o,y:t},{x:o+a,y:t},{x:o+a,y:t+n},{x:o,y:t+n}],s={left:2,right:0,top:3,bottom:1}[d];let r="";for(let e=s;e<s+l.length+1;e++){const c=l[e%l.length],u=l[(e+1)%l.length],f=i&&e<s+3?Math.min(i/Math.hypot(u.x-c.x,u.y-c.y),.5):0;e===s&&(r+=`M${c.x*(1-f)+u.x*f},${c.y*(1-f)+u.y*f}`),e>s&&(r+=`Q${c.x},${c.y} ${c.x*(1-f)+u.x*f},${c.y*(1-f)+u.y*f}`),e<s+l.length&&(r+=`L${c.x*f+u.x*(1-f)},${c.y*f+u.y*(1-f)}`)}return r+"Z"}const dt={line:"line",bar:"rectangle",threshold:"dashed"},dn=(o,t,a=1)=>{let n=o;(n<0||n>=t.length)&&(n=0);do{if(t[n].isValid&&t[n].hasData)return n;n+=a,n>=t.length?n=0:n<0&&(n=t.length-1)}while(n!==o);return 0};function un(o){const t=[];let a=-1;return o.forEach(n=>{n.series.type==="bar"?a===-1&&(a=t.length,t.push(n.series)):t.push(n.series)}),{navigableSeries:t,navigableBarSeriesIndex:a}}const Ie=(o,t)=>o instanceof Date&&t instanceof Date?o.getTime()===t.getTime():o===t;function fn(o){var t,a,n,i;const d=new Map,l=new Map,s=new Map;for(let r=0;r<o.length;r++)for(const e of o[r]){const c=ut(e.x);e.y<0?d.set(c,((t=d.get(c))!==null&&t!==void 0?t:0)+e.y):l.set(c,((a=l.get(c))!==null&&a!==void 0?a:0)+e.y);const u=(n=e.y<0?d.get(c):l.get(c))!==null&&n!==void 0?n:0,f=(i=s.get(c))!==null&&i!==void 0?i:new Map;f.set(r,u),s.set(c,f)}return s}const ut=o=>o instanceof Date?o.getTime():o;function ce(o){return o.type==="threshold"&&"y"in o}function re(o){return o.type==="threshold"&&"x"in o}function De(o){return o.type==="line"||o.type==="bar"}function hn({axis:o,series:t,color:a,xScale:n,yScale:i,highlighted:d,dimmed:l,highlightedGroupIndex:s,totalSeriesCount:r,seriesIndex:e,plotSize:c,chartAreaClipPath:u,stackedBarValues:f,isRtl:E}){const v=!!f,R=o==="x",h=(()=>{var b;if(t.type!=="bar"||!n.isCategorical())return[];const w=i.d3Scale,F=t.data.map(({x:z})=>n.d3Scale(z)||NaN),S=(b=i.d3Scale(0))!==null&&b!==void 0?b:NaN,k=isFinite(S)?Math.min(c,S):c;let M=n.d3Scale.bandwidth();const P=4,V=4;return!v&&r>1&&(M=(M-(r-1)*P)/r,M=Math.max(M,V)),F.map((z,A)=>{var O,Y,G,ee;const j=t.data[A],K=ut(j.x);let y=z,g=j.y,D=!v,I=!v;if(v){const B=(O=f.get(K))!==null&&O!==void 0?O:new Map;g=(Y=B.get(e))!==null&&Y!==void 0?Y:0;const L=Array.from(B.values()).sort((H,N)=>H-N);D=g===L[0],I=g===L[L.length-1]}else r>1&&(y+=e*(M+P));return g=g<0?g-j.y:g,{x:y,y:(G=w(g))!==null&&G!==void 0?G:NaN,width:M,height:Math.abs(((ee=w(j.y))!==null&&ee!==void 0?ee:NaN)-k),isRoundedStart:D,isRoundedEnd:I}})})(),T=s!==null?n.domain[s]:null;return m.createElement("g",{"aria-label":t.title,clipPath:`url(#${u})`,className:Le(ie.series,ie["series--bar"],{[ie["series--highlighted"]]:d,[ie["series--dimmed"]]:l})},h.map(({x:b,y:w,width:F,height:S,isRoundedStart:k,isRoundedEnd:M},P)=>{if(!isFinite(b)||!isFinite(S))return;const V=v?3:0,z=S<4,A=z?0:V,O=2,Y=z?2:4,G=R?{x:b+O/2,y:w+A/2,width:F-O,height:S-A}:{x:w-(E?0:S)+A/2,y:b+O/2,width:S-A,height:F-O},ee=Le(ie.series__rect,{[ie["series--dimmed"]]:T!==null&&!Ie(T,t.data[P].x)}),j={fill:a,className:ee};let K="none";return k&&M?K="all":!k&&!M?K="none":R?K=k?"bottom":"top":E?K=k?"right":"left":K=k?"left":"right",K==="all"?m.createElement("rect",Object.assign({key:P},G,j,{rx:Y})):K==="none"?m.createElement("rect",Object.assign({key:P},G,j,{rx:0})):m.createElement("path",Object.assign({key:P,d:cn(G,Y,K)},j))}))}function pn({axis:o,series:t,color:a,xScale:n,yScale:i,chartAreaClipPath:d}){var l;const s={"aria-hidden":!0,stroke:a,clipPath:`url(#${d})`};if(t.type==="line"){const r=Vt().x(c=>{let u=n.d3Scale(c.x)||0;if(n.isCategorical()){const f=Math.max(0,n.d3Scale.bandwidth()-1)/2;u+=f}return u}).y(c=>i.d3Scale(c.y)||0),e=t.data.filter(({x:c})=>n.d3Scale(c)!==void 0);return m.createElement("path",Object.assign({},s,{d:r(e)||""}))}else if(ce(t)){const[r,e]=n.d3Scale.range(),c=i.d3Scale(t.y),u=o==="x"?{x1:r,x2:e,y1:c,y2:c}:{x1:c,x2:c,y1:r,y2:e};return m.createElement("line",Object.assign({},s,u))}else if(re(t)){const[r,e]=i.d3Scale.range(),c=n.isCategorical()?Math.max(0,n.d3Scale.bandwidth()-1)/2:0,u=((l=n.d3Scale(t.x))!==null&&l!==void 0?l:NaN)+c,f=o==="x"?{x1:u,x2:u,y1:r,y2:e}:{x1:r,x2:e,y1:u,y2:u};return m.createElement("line",Object.assign({},s,f))}else return null}const it=2;function mn({axis:o,plotHeight:t,plotWidth:a,highlightedGroupIndex:n,highlightedSeries:i,stackedBars:d,isGroupNavigation:l,visibleSeries:s,xScale:r,yScale:e,isRtl:c}){const u=tt("awsui-mixed-line-bar-chart__chart-area-"),f=tt("awsui-line-chart__chart-area-"),E=p.useMemo(()=>{if(!d)return;const v=[];return s.forEach(({series:R})=>{R.type==="bar"?v.push(R.data):v.push([])}),fn(v)},[s,d]);return m.createElement(m.Fragment,null,m.createElement("defs",{"aria-hidden":"true"},m.createElement("clipPath",{id:u},m.createElement("rect",{x:0,y:0,width:a,height:t})),m.createElement("clipPath",{id:f},m.createElement("rect",{x:0,y:-it/2,width:a,height:t+it}))),m.createElement("g",{"aria-hidden":l?!0:void 0,role:"group"},s.map(({series:v,color:R},h)=>{const T=v===i,b=!!i&&!T;switch(v.type){case"line":case"threshold":return m.createElement("g",{key:h,role:"group","aria-label":v.title,className:Le(ie.series,ie[`series--${v.type}`],{[ie["series--highlighted"]]:T,[ie["series--dimmed"]]:b})},m.createElement(pn,{axis:o,series:v,color:R,xScale:r,yScale:e,chartAreaClipPath:f}));case"bar":return m.createElement(hn,{key:h,axis:o,series:v,color:R,totalSeriesCount:s.filter(w=>w.series.type==="bar").length,seriesIndex:h,xScale:r,yScale:e,plotSize:o==="y"?a:t,highlighted:T,dimmed:b,chartAreaClipPath:u,stackedBarValues:E,highlightedGroupIndex:n,isRtl:c})}})))}function gn(o,t){return t==="categorical"?o.reduce((a,n)=>(De(n.series)&&n.series.data.forEach(({x:i})=>{a.indexOf(i)===-1&&a.push(i)}),re(n.series)&&a.indexOf(n.series.x)===-1&&a.push(n.series.x),a),[]):o.reduce((a,n)=>{if(ce(n.series))return a;if(re(n.series)){const[i,d]=a,l=i==null||n.series.x<i?n.series.x:i,s=d==null||d<n.series.x?n.series.x:d;return[l,s]}return De(n.series)?n.series.data.reduce(([i,d],{x:l})=>{const s=i==null||l<i?l:i,r=d==null||d<l?l:d;return[s,r]},a):a},[])}function xn(o,t){for(let a=0;a<o.length;a++)if(t(o[a]))return o[a];return null}function yn(o,t,a){let n=o;if(a){const{positiveData:d,negativeData:l}=o.reduce((r,e)=>(e.series.type==="bar"&&e.series.data.forEach(({x:c,y:u})=>{const f=u<0?r.negativeData:r.positiveData,E=xn(f,v=>Ie(v.x,c));return E?E.y+=u:f.push({x:c,y:u}),r}),r),{positiveData:[],negativeData:[]});n=[...[{color:"",index:NaN,series:{type:"bar",title:"positive",data:d}},{color:"",index:NaN,series:{type:"bar",title:"negative",data:l}}],...n.filter(r=>r.series.type!=="bar")]}const i=n.reduce((d,l)=>{if(ce(l.series)){const[s,r]=d,e=s===void 0||l.series.y<s?l.series.y:s,c=r===void 0||r<l.series.y?l.series.y:r;return[e,c]}return re(l.series)?d:De(l.series)?l.series.data.reduce(([s,r],{y:e})=>{const c=s===void 0||e<s?e:s,u=r===void 0||r<e?e:r;return[c,u]},d):d},[0,0]);return t==="log"&&i[0]===0&&i[1]>1?[1,i[1]]:i}function st({position:o,series:t,xTickFormatter:a,detailPopoverSeriesContent:n}){const i=a?a(o):o.toString(),d=[];return t.forEach(l=>{const s=vn({internalSeries:l,targetX:o,detailPopoverSeriesContent:n});s&&d.push(s)}),{position:i,details:d}}function vn({internalSeries:o,targetX:t,detailPopoverSeriesContent:a}){var n;const{series:i,color:d}=o;if(re(i))return i.x===t?{key:i.title,value:"",color:d,markerType:"dashed"}:null;if(ce(i))return{key:i.title,value:i.valueFormatter?i.valueFormatter(i.y):i.y,color:d,markerType:"dashed"};if(De(i)){for(const l of i.data)if(Ie(t,l.x)){const s=a?a({series:i,x:t,y:l.y}):void 0,r=!!(!((n=s==null?void 0:s.subItems)===null||n===void 0)&&n.length),e=(s==null?void 0:s.expandable)&&r,c=typeof(s==null?void 0:s.key)=="string",u=s!=null&&s.key&&(!e||c)?s.key:i.title;return s!=null&&s.expandable,!c&&!e&&(s!=null&&s.value)&&s.value,{key:u,value:(s==null?void 0:s.value)||(i.valueFormatter?i.valueFormatter(l.y,t):l.y),color:d,markerType:i.type==="line"?"line":"rectangle",subItems:s==null?void 0:s.subItems,expandableId:e?i.title:void 0}}}return null}const ot=6,Fe=12;function bn({plotRef:o,popoverRef:t,scaledSeries:a,barGroups:n,highlightPoint:i,highlightGroup:d,clearHighlightedSeries:l,isGroupNavigation:s,isHandlersDisabled:r,highlightX:e}){const c=h=>{var T;if(!((T=t.current)===null||T===void 0)&&T.firstChild){const b=t.current.firstChild.getBoundingClientRect();if(h.clientX>b.x-Fe&&h.clientX<b.x+b.width+Fe&&h.clientY>b.y-Fe&&h.clientY<b.y+b.height+Fe)return!0}return!1},u=h=>{var T,b;const w=h.target.getBoundingClientRect(),F=h.clientX-w.left,S=a.map(k=>k.x).reduce((k,M)=>Math.abs(M-F)<Math.abs(k-F)?M:k,-1/0);if(isFinite(S)){const k=h.clientY-w.top,M=a.filter(P=>P.x===S||ce(P.series)).map(P=>P.y).reduce((P,V)=>Math.abs(V-k)<Math.abs(P-k)?V:P,-1/0);if(isFinite(M)&&Math.abs(F-S)<ot&&Math.abs(k-M)<ot){const[{color:P,datum:V,series:z}]=a.filter(A=>(A.x===S||ce(A.series))&&A.y===M);i({x:S,y:M,color:P,datum:V,series:z})}else{let P=null;for(const V of a)if(V.x===S){P=(b=(T=V.datum)===null||T===void 0?void 0:T.x)!==null&&b!==void 0?b:null;break}e({scaledX:S,label:P})}}},f=h=>{const T=h.target.getBoundingClientRect(),b=h.clientX-T.left,w=h.clientY-T.top;for(let F=0;F<n.length;F++){const{position:{x:S,y:k,width:M,height:P}}=n[F];if(S<=b&&b<=S+M&&k<=w&&w<=k+P){d(F);return}}l()};return{onSVGMouseMove:h=>{h.target===o.current.svg&&!r&&!c(h)&&(s?f(h):a.length>0&&u(h))},onSVGMouseOut:h=>{r||c(h)||(!Qe(o.current.svg,h.relatedTarget)||h.relatedTarget&&h.relatedTarget.classList.contains(ie.series))&&(e(null),l())},onPopoverLeave:h=>{!r&&Qe(o.current.svg,h.relatedTarget)&&(e(null),l())}}}function _n({series:o,visibleSeries:t,scaledSeries:a,barGroups:n,xScale:i,yScale:d,highlightedPoint:l,highlightedGroupIndex:s,highlightedSeries:r,isHandlersDisabled:e,pinPopover:c,highlightSeries:u,highlightGroup:f,highlightPoint:E,highlightX:v,verticalMarkerX:R,isRtl:h,horizontalBars:T}){const[b,w]=p.useState(null),[F,S]=p.useState(0),k=p.useMemo(()=>t.some(({series:y})=>y.type==="bar"),[t]),{navigableSeries:M}=p.useMemo(()=>un(t),[t]),P=M.length>1,V=()=>{const y=s??0;w(i.domain[y]),f(y)},z=()=>{var y;if(R===null){const g=h?O.length-1:0;P?ee(g):Y(0,(y=O[g].datum)===null||y===void 0?void 0:y.x)}},A=()=>{k?V():z()},O=p.useMemo(()=>{const y=[];for(let g=0;g<a.length;g+=1){const D=a[g];D!==void 0&&(!y.length||y[y.length-1].scaledX!==D.x)&&y.push({scaledX:D.x,datum:D.datum})}return y},[a]),Y=p.useCallback((y,g)=>{var D,I,B,L,H;if(k)return;const N=i.isCategorical()?Math.max(0,i.d3Scale.bandwidth()-1)/2:0,se=M.length-1;let ue=-1;r&&(ue=M.indexOf(r));const ge=P?-1:0;let q=0;if(ue!==null&&(q=ue+y,q>se?q=ge:q<ge&&(q=se)),q===-1){u(null),E(null);return}const X=M[q],xe=o.filter(({series:te})=>te===X)[0],fe=(D=b??g)!==null&&D!==void 0?D:null;let le=((I=i.d3Scale(fe))!==null&&I!==void 0?I:NaN)+N;if(isFinite(le)||(le=0),X.type==="line"){const Q=a.filter(U=>U.series===X).reduce((U,ye)=>Math.abs(ye.x-le)<Math.abs(U.x-le)?ye:U,{x:-1/0,y:-1/0});E(Object.assign(Object.assign({},Q),{color:xe.color,series:X}))}else if(ce(X)){const te=a.map(Q=>{var U;return((U=Q.datum)===null||U===void 0?void 0:U.x)||null}).indexOf(fe);E({x:le,y:(B=d.d3Scale(X.y))!==null&&B!==void 0?B:NaN,color:xe.color,series:X,datum:(L=a[te])===null||L===void 0?void 0:L.datum})}else re(X)&&E({x:(H=i.d3Scale(X.x))!==null&&H!==void 0?H:NaN,y:d.d3Scale.range()[0],color:xe.color,series:X,datum:{x:X.x,y:NaN}})},[k,i,M,r,P,u,E,o,b,a,d]),G=p.useCallback(y=>{var g;const D=r||t[0].series;if(D.type==="line"||ce(D)){const I=a.filter(se=>se.series===D),B=l||I[0],L=I.map(se=>se.x).indexOf(B.x),H=nt(L+y,[0,I.length-1]),N=I[H];w(((g=N.datum)===null||g===void 0?void 0:g.x)||null),S(H),E(N)}else if(D.type==="bar"){const I=i.domain,B=I.length-1;let L=0;s!==null&&(h&&!T&&(y=-y),L=s+y,L>B?L=0:L<0&&(L=B));const H=dn(L,n,y);w(I[H]),f(H)}},[r,t,a,l,E,i.domain,s,n,f,h,T]),ee=p.useCallback(y=>{var g,D,I,B;const L=O[y];S(y),w(((g=L.datum)===null||g===void 0?void 0:g.x)||null),v({scaledX:(D=L==null?void 0:L.scaledX)!==null&&D!==void 0?D:null,label:(B=(I=L.datum)===null||I===void 0?void 0:I.x)!==null&&B!==void 0?B:null})},[O,v]),j=p.useCallback(y=>{if(r||k)G(y);else{const g=nt(F+y,[0,O.length-1]);ee(g)}},[r,k,G,F,O.length,ee]),K=p.useCallback(y=>{const g=y.keyCode;g!==ne.up&&g!==ne.right&&g!==ne.down&&g!==ne.left&&g!==ne.space&&g!==ne.enter||(y.preventDefault(),!e&&(g===ne.down||g===ne.up?Y(g===ne.down?1:-1):g===ne.left||g===ne.right?j(g===ne.right?1:-1):(g===ne.enter||g===ne.space)&&c()))},[e,Y,j,c]);return{isGroupNavigation:k,onFocus:A,onKeyDown:K,xIndex:F}}function Sn(){const[o,t]=p.useState("closed"),a=o!=="closed",n=o==="pinned",i=p.useCallback(()=>t("open"),[]),d=p.useCallback(()=>t("pinned"),[]),l=p.useCallback(()=>t("closed"),[]);return{isPopoverOpen:a,isPopoverPinned:n,showPopover:i,pinPopover:d,dismissPopover:l}}function kn(o,t,a,n,i){return t.isCategorical()?t.domain.map(d=>{const l=t.d3Scale(d),s=typeof l<"u"&&isFinite(l);return{x:d,isValid:s,hasData:o.some(({series:r})=>ce(r)?!0:re(r)?!1:De(r)?r.data.some(e=>Ie(e.x,d)):!1),position:i==="x"?{x:0,y:s&&l||0,width:a,height:t.d3Scale.bandwidth()}:{x:s&&l||0,y:0,width:t.d3Scale.bandwidth(),height:n}}}):[]}function Cn(o,t,a){const n=t.isCategorical()?Math.max(0,t.d3Scale.bandwidth()-1)/2:0,i=e=>(t.d3Scale(e)||0)+n,d=e=>a.d3Scale(e)||0,l=En(o);function s(e,c,u){var f,E;const v=i(c.x);let R=-1;for(let h=0;h<e.length-1;h++)if(e[h].x<v&&v<e[h+1].x){R=h;break}if(R!==-1){const h=((f=e[R].datum)===null||f===void 0?void 0:f.y)||0,T=((E=e[R+1].datum)===null||E===void 0?void 0:E.y)||0,b=(h+T)/2;e.push({x:v,y:d(b),datum:{x:c.x,y:NaN},series:e[R].series,color:u})}}const r=o.map(({series:e,color:c})=>{const u=[];if(e.type==="line"){for(const f of e.data)u.push({x:i(f.x),y:d(f.y),datum:f,series:e,color:c});u.sort((f,E)=>f.x-E.x);for(const f of o)re(f.series)&&s(u,f.series,f.color)}else if(ce(e)){for(const f of l)u.push({x:i(f),y:d(e.y),datum:{x:f,y:e.y},series:e,color:c});l.length===0&&u.push({x:NaN,y:d(e.y),series:e,color:c})}else re(e)&&u.push({x:i(e.x),y:NaN,datum:{x:e.x,y:NaN},series:e,color:c});return u});return Mn(r).sort((e,c)=>e.x-c.x)}function En(o){const t=new Set;for(const{series:n}of o)switch(n.type){case"bar":case"line":for(const i of n.data)t.add(i.x);break;case"threshold":re(n)&&t.add(n.x);break}const a=[];return t.forEach(n=>a.push(n)),a}function Mn(o){const t=[];for(const a of o)for(const n of a)t.push(n);return t}const Pn=16,at=12,lt=500;function Tn(o){var t,{fitHeight:a,hasFilters:n,height:i,series:d,visibleSeries:l,highlightedSeries:s,onHighlightChange:r,highlightedPoint:e,setHighlightedPoint:c,highlightedGroupIndex:u,setHighlightedGroupIndex:f,detailPopoverFooter:E,detailPopoverSize:v="medium",stackedBars:R=!1,horizontalBars:h=!1,xScaleType:T,yScaleType:b,xTickFormatter:w,yTickFormatter:F,emphasizeBaselineAxis:S,xTitle:k,yTitle:M,ariaLabel:P,ariaLabelledby:V,ariaDescription:z,i18nStrings:A={},detailPopoverSeriesContent:O}=o,Y=He(o,["fitHeight","hasFilters","height","series","visibleSeries","highlightedSeries","onHighlightChange","highlightedPoint","setHighlightedPoint","highlightedGroupIndex","setHighlightedGroupIndex","detailPopoverFooter","detailPopoverSize","stackedBars","horizontalBars","xScaleType","yScaleType","xTickFormatter","yTickFormatter","emphasizeBaselineAxis","xTitle","yTitle","ariaLabel","ariaLabelledby","ariaDescription","i18nStrings","detailPopoverSeriesContent"]);const G=p.useRef(null),ee=p.useRef(null),[j,K]=p.useState(0),[y,g]=p.useState(null),[D,I]=p.useState(""),[B,L]=Lt(lt),H=Math.round(B/2),N=B?Math.max(0,B-Math.min(j,H)-Pn):lt,se=p.useRef(null),ue=rt(L,se),ge=p.useRef(null),q=Ht(se.current),X=Y.xDomain||gn(d,T),xe=Y.yDomain||yn(d,b,R),fe=d.every(({series:x})=>x.type==="line"||x.type==="threshold");function le(x,C){const Z=Jt(x),me=new qt(T,X,C,fe),Be=Ut(me,Z);return{axis:"x",tickCount:Z,scale:me,ticks:Be,tickFormatter:w,title:k,ariaRoleDescription:A.xAxisAriaRoleDescription}}function te(x,C){const Z=en(x),me=new Zt(b,xe,C,Y.yDomain?null:Z),Be=Qt(me,Z);return{axis:"y",tickCount:Z,scale:me,ticks:Be,tickFormatter:F,title:M,ariaRoleDescription:A.yAxisAriaRoleDescription}}const Q=h?te(N,q?[N,0]:[0,N]):le(N,q?[N,0]:[0,N]),U=zt(Object.assign({},Q)),ye=p.useRef(null),ve=Dt(()=>ye.current,!a),J=a?ve??0:i,$=h?le(J,[0,J]):te(J,[J,0]),oe=Q.axis==="x"?Q:$.axis==="x"?$:null,ae=Q.axis==="y"?Q:$.axis==="y"?$:null;if(!oe||!ae)throw new Error("Invariant violation: invalid axis props.");const Ce=p.useRef(null),Ne=p.useRef(null),be=h?"y":"x",Pe=h?"x":"y",Ee=Cn(l,oe.scale,ae.scale),he=kn(l,oe.scale,N,J,Pe),{isPopoverOpen:_,isPopoverPinned:W,showPopover:Me,pinPopover:Xe,dismissPopover:_e}=Sn(),[Ve,ze]=p.useState(!1);p.useEffect(()=>{if(W)ze(!0);else{const x=setTimeout(()=>ze(!1),25);return()=>clearTimeout(x)}},[W]);const Se=p.useCallback(x=>{x!==s&&r(x)},[s,r]),Ge=p.useCallback(x=>{var C,Z;f(null),c(x),x&&(Se(x.series),g({scaledX:x.x,label:(Z=(C=x.datum)===null||C===void 0?void 0:C.x)!==null&&Z!==void 0?Z:null}))},[f,c,Se]),Te=p.useCallback(()=>{c(null),Se(null),f(null)},[Se,f,c]),$e=p.useCallback(x=>{x&&Te(),g(x)},[Te]),We=p.useCallback(x=>{Se(null),c(null),f(x)},[Se,c,f]),Ae=p.useCallback(()=>{Te(),_e()},[_e,Te]),Ye=_n({series:d,visibleSeries:l,scaledSeries:Ee,barGroups:he,xScale:oe.scale,yScale:ae.scale,highlightedPoint:e,highlightedGroupIndex:u,highlightedSeries:s,isHandlersDisabled:Ve,pinPopover:Xe,highlightSeries:Se,highlightGroup:We,highlightPoint:Ge,highlightX:$e,clearHighlightedSeries:Ae,verticalMarkerX:y,isRtl:!!q,horizontalBars:h}),{isGroupNavigation:ke}=Ye,je=He(Ye,["isGroupNavigation"]),{onSVGMouseMove:ft,onSVGMouseOut:ht,onPopoverLeave:pt}=bn({scaledSeries:Ee,barGroups:he,plotRef:G,popoverRef:ge,highlightPoint:Ge,highlightGroup:We,clearHighlightedSeries:Ae,isGroupNavigation:ke,isHandlersDisabled:Ve,highlightX:$e}),de=p.useMemo(()=>{var x,C;return u!==null?he[u].x:y!==null?y.label:(C=(x=e==null?void 0:e.datum)===null||x===void 0?void 0:x.x)!==null&&C!==void 0?C:null},[e,y,u,he]);p.useEffect(()=>{const x=C=>{C.key==="Escape"&&_e()};return document.addEventListener("keydown",x),()=>document.removeEventListener("keydown",x)},[_e]),p.useLayoutEffect(()=>{(de!==null||e!==null)&&Me()},[de,e,Me]);const mt=x=>{_e(),x?(Te(),g(null)):setTimeout(()=>{var C,Z;!!(e||u!==null||y)?(C=G.current)===null||C===void 0||C.focusApplication():(Z=G.current)===null||Z===void 0||Z.focusPlot()},0)},gt=x=>{_?W?_e():(Xe(),x.preventDefault()):Me()},xt=(x,C)=>{C==="keyboard"&&je.onFocus()},Ke=x=>{const C=x.relatedTarget||x.target;(C===null||!(C instanceof Element)||!ct(se.current,C))&&(Ae(),g(null),_&&!W&&_e())},yt=je.onKeyDown,vt=oe.scale.isCategorical()?Math.max(0,oe.scale.d3Scale.bandwidth()-1)/2:0;let pe=null;if(y!==null)pe=y.scaledX;else if(ke&&u!==null){const x=(t=oe.scale.d3Scale(he[u].x))!==null&&t!==void 0?t:null;x!==null&&(pe=vt+x)}const bt=p.useMemo(()=>e?{key:`${e.x}-${e.y}`,x:e.x,y:e.y,color:e.color}:null,[e]),_t=p.useMemo(()=>pe!==null?Ee.filter(({x,y:C})=>(x===pe||isNaN(x))&&!isNaN(C)).map(({x,y:C,color:Z},me)=>({key:`${me}-${x}-${C}`,x:h?C:pe||0,y:h?pe||0:C,color:Z})):[],[Ee,pe,h]),qe=ke?Ne:e?Ce:ee,Oe=p.useMemo(()=>{if(de===null)return null;if(e){const x=l.filter(C=>C.series===(e==null?void 0:e.series)||re(C.series));return st({position:de,series:x,xTickFormatter:w,detailPopoverSeriesContent:O})}return st({position:de,series:l,xTickFormatter:w,detailPopoverSeriesContent:O})},[de,e,l,w,O]),St=p.useMemo(()=>E&&de?E(de):null,[E,de]),we=Oe&&D?`${Oe.position}, ${D}`:"",kt=we&&!e&&u===null?we:"",Ct=!e&&y,Et=tn();return m.createElement(Gt,{ref:ue,minHeight:i+U.height,fitHeight:!!a,hasFilters:n,leftAxisLabel:m.createElement(Je,{axis:Pe,position:"left",title:$.title}),leftAxisLabelMeasure:m.createElement($t,{ticks:$.ticks,scale:$.scale,tickFormatter:$.tickFormatter,autoWidth:K,maxLabelsWidth:H}),bottomAxisLabel:m.createElement(Je,{axis:be,position:"bottom",title:Q.title}),chartPlot:m.createElement(Nt,{ref:G,width:"100%",height:a?`calc(100% - ${U.height}px)`:J,offsetBottom:U.height,isClickable:_&&!W,ariaLabel:P,ariaLabelledby:V,ariaDescription:z,ariaRoleDescription:A==null?void 0:A.chartAriaRoleDescription,ariaLiveRegion:kt,activeElementRef:qe,activeElementKey:we,activeElementFocusOffset:ke?0:Ct?{x:8,y:0}:3,onMouseMove:ft,onMouseOut:ht,onClick:gt,onApplicationFocus:xt,onApplicationBlur:Ke,onKeyDown:yt},m.createElement("line",{ref:ye,x1:"0",x2:"0",y1:"0",y2:"100%",stroke:"transparent",strokeWidth:1,style:{pointerEvents:"none"}}),m.createElement(Wt,{axis:Pe,ticks:$.ticks,scale:$.scale,tickFormatter:$.tickFormatter,title:$.title,ariaRoleDescription:$.ariaRoleDescription,maxLabelsWidth:H,plotWidth:N,plotHeight:J}),h&&m.createElement(sn,{scale:ae.scale,ticks:ae.ticks,height:J}),S&&fe&&m.createElement(et,{axis:be,scale:ae.scale,width:N,height:J}),m.createElement(mn,{axis:be,plotWidth:N,plotHeight:J,highlightedSeries:s??null,highlightedGroupIndex:u,stackedBars:R,isGroupNavigation:ke,visibleSeries:l,xScale:oe.scale,yScale:ae.scale,isRtl:!!q}),S&&!fe&&m.createElement(et,{axis:be,scale:ae.scale,width:N,height:J}),m.createElement(Yt,{key:pe||"",height:J,showPoints:e===null,showLine:!ke,points:_t,ref:ee}),e&&m.createElement(jt,{ref:Ce,point:bt,role:"button",ariaLabel:we,ariaHasPopup:!0,ariaExpanded:W}),ke&&oe.scale.isCategorical()&&m.createElement(an,{ariaLabel:we,isRefresh:Et,isPopoverPinned:W,barGroups:he,highlightedGroupIndex:u,highlightedGroupRef:Ne}),m.createElement(Kt,Object.assign({},U,{axis:be,scale:Q.scale,title:Q.title,ariaRoleDescription:Q.ariaRoleDescription,height:J,width:N,offsetLeft:j+at,offsetRight:at,isRTL:q}))),popover:m.createElement(ln,{ref:ge,containerRef:se,trackRef:qe,isOpen:_,isPinned:W,highlightDetails:Oe,onDismiss:mt,size:v,footer:St,dismissAriaLabel:A.detailPopoverDismissAriaLabel,onMouseLeave:pt,onBlur:Ke,setPopoverText:I})})}function wn({series:o,visibleSeries:t,highlightedSeries:a,onHighlightChange:n,legendTitle:i,ariaLabel:d,plotContainerRef:l}){const s=p.useMemo(()=>o.filter(r=>t.indexOf(r.series)!==-1).map(({series:r,color:e})=>({label:r.title,type:dt[r.type],color:e,datum:r})),[o,t]);return m.createElement(Rt,{series:s,highlightedSeries:a||null,onHighlightChange:n,legendTitle:i,ariaLabel:d,plotContainerRef:l})}function Wn(o){var{fitHeight:t,height:a,xScaleType:n,yScaleType:i,xDomain:d,yDomain:l,xTickFormatter:s,yTickFormatter:r,highlightedSeries:e,visibleSeries:c,series:u,onFilterChange:f,onHighlightChange:E,i18nStrings:v,ariaLabel:R,ariaLabelledby:h,ariaDescription:T,xTitle:b,yTitle:w,stackedBars:F,horizontalBars:S,hideFilter:k,additionalFilters:M,hideLegend:P,legendTitle:V,statusType:z,detailPopoverSize:A,detailPopoverFooter:O,detailPopoverSeriesContent:Y,emphasizeBaselineAxis:G,empty:ee,noMatch:j,errorText:K,loadingText:y,recoveryText:g,onRecoveryClick:D,__internalRootRef:I=null}=o,B=He(o,["fitHeight","height","xScaleType","yScaleType","xDomain","yDomain","xTickFormatter","yTickFormatter","highlightedSeries","visibleSeries","series","onFilterChange","onHighlightChange","i18nStrings","ariaLabel","ariaLabelledby","ariaDescription","xTitle","yTitle","stackedBars","horizontalBars","hideFilter","additionalFilters","hideLegend","legendTitle","statusType","detailPopoverSize","detailPopoverFooter","detailPopoverSeriesContent","emphasizeBaselineAxis","empty","noMatch","errorText","loadingText","recoveryText","onRecoveryClick","__internalRootRef"]);const L=Mt(B),H=p.useRef(null);p.useEffect(()=>{u.some(_=>_.type==="bar"),u.some(_=>_.type==="line");for(const _ of u)_.type==="threshold"&&_.x!==void 0&&_.y,_.type==="threshold"&&_.x===void 0&&_.y},[n,S,u]);const N=p.useMemo(()=>{const _=Ft(u,W=>ce(W)||re(W),W=>W.color||null);return u.map((W,Me)=>({index:Me,color:_[Me],series:W}))},[u]),[se,ue]=p.useState(null),[ge,q]=p.useState(null),[X=null,xe]=Ze(e,E,null,{componentName:"MixedLineBarChart",controlledProp:"highlightedSeries",changeHandler:"onHighlightChange"}),[fe,le]=p.useState(X);p.useEffect(()=>{le(e||null)},[e]);const[te,Q]=Ze(c,f,u,{componentName:"MixedLineBarChart",controlledProp:"visibleSeries",changeHandler:"onFilterChange"}),U=p.useMemo(()=>N.filter(_=>(te==null?void 0:te.indexOf(_.series))!==-1),[N,te]),ye=_=>{Q(_),Ue(f,{visibleSeries:_})},ve=_=>{xe(_),Ue(E,{highlightedSeries:_}),le(_)},J=_=>{_.relatedTarget&&!ct(H.current,_.relatedTarget)&&(X&&ve(X),ue(null),q(null),le(null))},{isEmpty:$,isNoMatch:oe,showChart:ae}=It({externalData:u,visibleData:U||[],statusType:z}),Ce=z==="finished"&&(!$||oe)&&(M||!k),Ne=!P&&!$&&z==="finished",be=!ae&&!P,Pe=!ae&&!oe&&(!k||M),Ee=rt(H,I),he=N.map(({series:_,color:W})=>({label:_.title,type:dt[_.type],color:W,datum:_}));return m.createElement(At,Object.assign({ref:Ee},L,{className:Le(L.className,ie.root),fitHeight:!!t,contentMinHeight:a,defaultFilter:Ce&&!k?m.createElement(Ot,{series:he,onChange:ye,selectedSeries:te||[],i18nStrings:v}):null,additionalFilters:Ce?M:null,reserveFilterSpace:!!Pe,reserveLegendSpace:!!be,chartStatus:m.createElement(Bt,{isEmpty:$,isNoMatch:oe,showChart:ae,statusType:z,empty:ee,noMatch:j,loadingText:y,errorText:K,recoveryText:g,onRecoveryClick:D}),chart:ae?m.createElement(Tn,{fitHeight:t,hasFilters:!!Ce,height:a,xScaleType:n,yScaleType:i,xDomain:d,yDomain:l,xTickFormatter:s??(v==null?void 0:v.xTickFormatter),yTickFormatter:r??(v==null?void 0:v.yTickFormatter),emphasizeBaselineAxis:G,stackedBars:F,horizontalBars:S,series:N,visibleSeries:U,highlightedSeries:X,onHighlightChange:ve,highlightedPoint:se,setHighlightedPoint:ue,highlightedGroupIndex:ge,setHighlightedGroupIndex:q,detailPopoverSize:A,detailPopoverFooter:O,detailPopoverSeriesContent:Y,xTitle:b,yTitle:w,ariaLabel:R,ariaLabelledby:h,ariaDescription:T,i18nStrings:v}):null,legend:Ne?m.createElement(wn,{series:N,visibleSeries:te||[],highlightedSeries:fe,onHighlightChange:ve,legendTitle:V,ariaLabel:v==null?void 0:v.legendAriaLabel,plotContainerRef:H}):null,onBlur:J}))}export{Wn as I};
